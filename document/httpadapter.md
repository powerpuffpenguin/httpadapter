# httpadapter 協議

本文檔定義的協議被成爲 httpadapter 協議，它是由飛天企鵝研發設計的。協議的目標是，簡單，完整，高效，併發。簡單要求這個協議不能太複雜以方便嵌入式實現，完整需要這套協議能夠靈活的支持絕大部分的 http 接口的適配，高效需要服務器能夠由效率的進行處理，併發是此協議的服務器實現版本應該能儘量處理更多的客戶端同時訪問。

httpadapter 協議是一個分層協議，它分爲如下量層:

* [傳輸層](#傳輸層)
* [邏輯層](#邏輯層)

## 傳輸層

傳輸層主要負責的數據傳輸，它在同一個 tcp 連接中使用 tcp 復用模擬了多個併發的 tcp(稱爲 通道 channel)

首先客戶端與服務器之間需要建立一個 tcp 連接作爲最底層的數據傳輸通道我們後文稱它爲 tcp-chain。

之後客戶的就可以在 tcp-chain 上創建一個通道後文稱爲 channel，每個 channel 都是獨立且支持雙向傳輸的，客戶端可以簡單的把它理解爲一個獨立的tcp或任何類似的雙向讀寫設備。

客戶端由任何的http需要訪問就創建一個 channel，然後經數據寫入到 channel ，channel 將數據由 tcp-chain 傳遞給服務器，服務器在代理訪問 http 後將結果由 channel 傳遞回客戶端，當一個請求完成或出現任何錯誤時客戶端關閉此 channel 服務器收到 channel 關閉通知後釋放其上的資源

你可以在此查看[傳輸層](transport.md)的詳細定義

## 邏輯層

在 channel 傳輸的是邏輯層的數據，它依據要轉發的 http 類型不同而各異，簡單來說每個 channel 和 一個 http 請求響應綁定，http 的數據將由 channel 在http服務器和客戶端中進行中轉翻譯
